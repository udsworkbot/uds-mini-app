<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        .step { display: none; padding: 15px; }
        .active { display: block; }
        select, input { width: 100%; padding: 8px; margin: 10px 0; }
        button { background: #007bff; color: white; border: none; padding: 10px; }
    </style>
</head>
<body>
    <!-- –®–∞–≥ 1: –í—ã–±–æ—Ä —É—á–∞—Å—Ç–∫–∞ -->
    <div id="step1" class="step active">
        <h3>üèó –í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–æ–∫:</h3>
        <select id="section"></select>
        <button onclick="showStep(2)">–î–∞–ª–µ–µ</button>
    </div>

    <!-- –®–∞–≥ 2: –í—ã–±–æ—Ä –æ–±—ä–µ–∫—Ç–∞ -->
    <div id="step2" class="step">
        <h3>üìã –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç:</h3>
        <select id="object"></select>
        <button onclick="showStep(1)">–ù–∞–∑–∞–¥</button>
        <button onclick="showStep(3)">–î–∞–ª–µ–µ</button>
    </div>

    <!-- –®–∞–≥ 3: –í—ã–±–æ—Ä –≤–∏–¥–∞ —Ä–∞–±–æ—Ç -->
    <div id="step3" class="step">
        <h3>üîß –í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥ —Ä–∞–±–æ—Ç:</h3>
        <select id="workType"></select>
        <button onclick="showStep(2)">–ù–∞–∑–∞–¥</button>
        <button onclick="showStep(4)">–î–∞–ª–µ–µ</button>
    </div>

    <!-- –®–∞–≥ 4: –í–≤–æ–¥ –æ–±—ä–µ–º–∞ -->
    <div id="step4" class="step">
        <h3>üìä –í–≤–µ–¥–∏—Ç–µ –æ–±—ä–µ–º:</h3>
        <input type="number" id="volume" step="0.01">
        <button onclick="showStep(3)">–ù–∞–∑–∞–¥</button>
        <button onclick="submitWork()">–ì–æ—Ç–æ–≤–æ</button>
    </div>

    <script>
        let workData = {};
        let appData = {}; // –î–æ–±–∞–≤–ª–µ–Ω–æ: –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è –¥–∞–Ω–Ω—ã—Ö

        // –£–¥–∞–ª–µ–Ω–æ: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ API
        // –ë—ã–ª–æ:
        // async function loadSections() { ... }

        // –î–æ–±–∞–≤–ª–µ–Ω–æ: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ URL
        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            const encodedData = urlParams.get('data');
            if (encodedData) {
                try {
                    appData = JSON.parse(decodeURIComponent(encodedData));
                    updateSelect('section', appData.sections || []);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö:', error);
                }
            }
        }

        // –ò–∑–º–µ–Ω–µ–Ω–æ: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
        function loadData(step) {
            const section = workData.section;
            const object = workData.object;

            switch (step) {
                case 2:
                    return appData.objects?.[section] || [];
                case 3:
                    return appData.workTypes?.[section]?.[object] || [];
                default:
                    return [];
            }
        }

        // –ò–∑–º–µ–Ω–µ–Ω–æ: –£–±—Ä–∞–Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å
        function showStep(step) {
            if (step === 2) {
                workData.section = document.getElementById('section').value;
                updateSelect('object', loadData(2));
            }
            if (step === 3) {
                workData.object = document.getElementById('object').value;
                updateSelect('workType', loadData(3));
            }

            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–æ: –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤
        function updateSelect(elementId, items) {
            const select = document.getElementById(elementId);
            select.innerHTML = '';
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.text = item;
                select.appendChild(option);
            });
        }

        // –£–¥–∞–ª–µ–Ω–æ: –í—ã–∑–æ–≤ loadSections()
        // –î–æ–±–∞–≤–ª–µ–Ω–æ: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', init); // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: init –≤–º–µ—Å—Ç–æ loadSections
    </script>
</body>
</html>
